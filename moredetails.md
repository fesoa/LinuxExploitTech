# 잡다구리 정보

##  패턴만들기

* metasploit 이용

  ```bash
  $/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 100
  Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A
  ```

* gdb-peda 이용

  ```bash
  gdb-peda$ pattern create 100
  'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL'
  ```


## gdb

* 함수 정보 찾기

  ```bash
  gdb-peda$ info function
  All defined functions:

  Non-debugging symbols:
  0x08049000  _init
  0x08049030  read@plt
  0x08049040  printf@plt
  0x08049050  __libc_start_main@plt
  0x08049060  dlsym@plt
  0x08049070  _start
  0x080490b0  _dl_relocate_static_pie
  0x080490c0  __x86.get_pc_thunk.bx
  0x080490d0  deregister_tm_clones
  ...
  ```


## objdump

* 함수 정보 찾기

  ```bash
  $objdump -d 프로그램명
  ```


## 값 입력

* 인자로 입력

  ```bash
  $python -c "print '값값값'" | ./프로그램
  ```

* gets 등 프로그램에서 입력



## 함수 주소 찾기/libc 이용

* 함수 주소는 ASLR이 적용되어 있다면 계속 변화하지만, 이것은 libcbase 주소가 변화하는 것이지 함수의 오프셋이 변화하지 않음
* 오프셋을 이용해야 reliable하게 가능: 함수주소 = libc base + 오프셋
* 현재 함수의 주소 - 현재 libc base = 릭된 함수의 주소 - [libc base]를 통해 계산 가능
* 즉 특정 함수의 주소를 릭해야함
* libc base = 현재 libc base - 현재 함수 주소 + 릭된 함수 주소
* https://github.com/niklasb/libc-database 에서 버전별 libc 주소 확인 가능
* libc 위치찾기

```
root@attacker:~/Study/LinuxExTech/# locate libc.so
/usr/lib/x86_64-linux-gnu/libc.so
/usr/lib/x86_64-linux-gnu/libc.so.6
/usr/lib32/libc.so.6
```



* 현재 libc base 주소 확인(gdb-peda)

  ```bash
  gdb-peda$ info proc map
  process 19033
  Mapped address spaces:

  	Start Addr   End Addr       Size     Offset objfile
  	 0x8048000  0x8049000     0x1000        0x0 /root/Study/LinuxExTech/02.ReturnToLibc/rtl2_32
  	 0x8049000  0x804a000     0x1000     0x1000 /root/Study/LinuxExTech/02.ReturnToLibc/rtl2_32
  	 0x804a000  0x804b000     0x1000     0x2000 /root/Study/LinuxExTech/02.ReturnToLibc/rtl2_32
  	 0x804b000  0x804c000     0x1000     0x2000 /root/Study/LinuxExTech/02.ReturnToLibc/rtl2_32
  	 0x804c000  0x804d000     0x1000     0x3000 /root/Study/LinuxExTech/02.ReturnToLibc/rtl2_32
  	0xf7dc5000 0xf7dde000    0x19000        0x0 /usr/lib32/libc-2.28.so
  	0xf7dde000 0xf7f2c000   0x14e000    0x19000 /usr/lib32/libc-2.28.so
  	0xf7f2c000 0xf7f9c000    0x70000   0x167000 /usr/lib32/libc-2.28.so
  	0xf7f9c000 0xf7f9d000     0x1000   0x1d7000
  ```

* 함수 주소 확인

  ```
  gdb-peda$ print system
  $6 = {<text variable, no debug info>} 0xf7e03980 <system>
  gdb-peda$ print printf
  $7 = {<text variable, no debug info>} 0xf7e178c0 <printf>
  ```

* 오프셋 계산

  ```
  gdb-peda$ p/x 0xf7e178c0(릭된 printf주소) - 0xf7dc5000(현재 libcbase)
  $8 = 0x528c0
  ```
