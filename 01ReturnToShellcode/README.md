# 01. Return to Shellcode
* ret 주소를 변경하여 Shellcode를 가리키게 함
* ret 주소를 변경할 수 있는 방법(overflow)과 shellcode 영역에 실행 권한이 있어야함

## CALL & RET 이해하기
* 두명령어는 아래와 같은 실행을 진행
  * call <operation>: 리턴주소를 스택에 저장하고, 그 주소로 이동
    * PUSH RetrunAddress
    * JMP <operation>

  * ret: POP으로 스택에 가장 상위의 값을 RIP에 저장하고, 해당 주소로 이동
    * POP RIP -> JMP RIP
```
#include <stdio.h>
#include <unistd.h>

void vuln(){
}

void main(){
    vuln();
}
```


## 메모리의 실행권한 확인
* 메모리는 실행권한이 r, w, x로 나누어져있음(읽기, 쓰기, 실행)
* 최신 gcc는 일반적으로 DEP(NX bit)가 적용되므로 코드 영역만 실행권한 설정됨
* 스택에서 shellcode 실행을 위해서는 컴파일 과정에서 -z execstack 추가해야


## 취약 프로그램 1
```
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv)
{
  char buffer[64];

  gets(buffer);
}
```



## 취약 프로그램2
```
#include <stdio.h>
#include <unistd.h>

void vuln(){
    char buf[50];
    printf("buf[50] address : %p\n",buf);
    read(0, buf, 100);
}

void main(){
    vuln();
}
```
